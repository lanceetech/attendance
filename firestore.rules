/**
 * @file Firestore Security Rules
 * @description This ruleset enforces a role-based access control model for the ClassSync application.
 *
 * Data Structure:
 * - /users/{userId}: Stores user profiles, with the document ID matching the Firebase Auth UID.
 * - /units/{unitId}: Stores information about course units.
 * - /classes/{classId}: Stores details about scheduled class sessions.
 * - /classes/{classId}/attendance/{attendanceId}: Subcollection for class attendance records.
 * - /classrooms/{roomId}: Stores information about physical classrooms.
 * - /feedback/{feedbackId}: Stores feedback submissions from users.
 * - /studentTimetable/{entryId}: Stores student timetable data.
 * - /lecturerTimetable/{entryId}: Stores lecturer timetable data.
 *
 * Key Security Decisions:
 * - User profiles are readable by anyone but writable only by the user themselves.
 * - Units and classes are readable by anyone, but write access is not explicitly granted in this prototype.
 * - Attendance records are readable and writable by anyone in this prototype.
 * - Classrooms are readable by anyone, but write access is not explicitly granted.
 * - Feedback is readable and writable by anyone.
 * - Timetable data is readable by anyone but write access is not explicitly granted in this prototype.
 *
 * Denormalization for Authorization:
 *  N/A - No denormalization is used in this ruleset.
 *
 * Structural Segregation:
 * N/A - No structural segregation is used in this ruleset.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Controls access to user profile documents.
     * @path /users/{userId}
     * @allow (read) User with any auth can read any user profile.
     * @allow (create, update, delete) User with matching auth UID can modify their own profile.
     * @deny (create, update, delete) User cannot modify another user's profile.
     * @principle Enforces document ownership for writes.
     */
    match /users/{userId} {
      allow get: if true;
      allow list: if true;
      allow create: if request.auth.uid == userId;
      allow update: if request.auth.uid == userId && resource.data.uid == userId;
      allow delete: if request.auth.uid == userId && resource.data.uid == userId && resource != null;
    }

    /**
     * @description Controls access to course unit documents.
     * @path /units/{unitId}
     * @allow (read) Anyone can read unit information.
     * @deny (create, update, delete) No one can create, update, or delete units in this prototype.
     * @principle Public read access with no write access granted.
     */
    match /units/{unitId} {
      allow get: if true;
      allow list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Controls access to class session documents.
     * @path /classes/{classId}
     * @allow (read) Anyone can read class session information.
     * @deny (create, update, delete) No one can create, update, or delete classes in this prototype.
     * @principle Public read access with no write access granted.
     */
    match /classes/{classId} {
      allow get: if true;
      allow list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Controls access to attendance records for a specific class.
     * @path /classes/{classId}/attendance/{attendanceId}
     * @allow (read, create, update, delete) Anyone can read, create, update and delete attendance records.
     * @principle Public read and write access.
     */
    match /classes/{classId}/attendance/{attendanceId} {
      allow get: if true;
      allow list: if true;
      allow create: if true;
      allow update: if true;
      allow delete: if resource != null;
    }

    /**
     * @description Controls access to classroom documents.
     * @path /classrooms/{roomId}
     * @allow (read) Anyone can read classroom information.
     * @deny (create, update, delete) No one can create, update, or delete classrooms in this prototype.
     * @principle Public read access with no write access granted.
     */
    match /classrooms/{roomId} {
      allow get: if true;
      allow list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Controls access to feedback documents.
     * @path /feedback/{feedbackId}
     * @allow (read, create, update, delete) Anyone can read, create, update and delete feedback.
     * @principle Public read and write access.
     */
    match /feedback/{feedbackId} {
      allow get: if true;
      allow list: if true;
      allow create: if true;
      allow update: if true;
      allow delete: if resource != null;
    }
    /**
     * @description Controls access to student timetable entries.
     * @path /studentTimetable/{entryId}
     * @allow (read) Anyone can read student timetable entries.
     * @deny (create, update, delete) No one can create, update, or delete student timetable entries in this prototype.
     * @principle Public read access with no write access granted.
     */
    match /studentTimetable/{entryId} {
      allow get: if true;
      allow list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Controls access to lecturer timetable entries.
     * @path /lecturerTimetable/{entryId}
     * @allow (read) Anyone can read lecturer timetable entries.
     * @deny (create, update, delete) No one can create, update, or delete lecturer timetable entries in this prototype.
     * @principle Public read access with no write access granted.
     */
    match /lecturerTimetable/{entryId} {
      allow get: if true;
      allow list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }
  }
}